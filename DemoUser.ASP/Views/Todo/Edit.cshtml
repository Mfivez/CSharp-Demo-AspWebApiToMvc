@{
    ViewData["Title"] = "Edit Todo";
    var todoId = ViewBag.TodoId;
}

<h2>Edit Todo</h2>

<div class="mb-3">
    <label class="form-label">Title</label>
    <input id="title" class="form-control" />
</div>

<div class="form-check mb-3">
    <input id="isDone" class="form-check-input" type="checkbox" />
    <label class="form-check-label">Done</label>
</div>

<button class="btn btn-primary" onclick="updateTodo()">Save</button>

<script>
    const API_BASE = "http://localhost:5062/api/todos";
    const JWT = "@Context.Session.GetString("JWT")";
    const TODO_ID = "@todoId";

    if (!JWT) {
        window.location.href = "/Auth/Login";
    }

    function updateTodo() {
        const title = document.getElementById("title").value.trim();
        const isDone = document.getElementById("isDone").checked;

        fetch(`${API_BASE}/${TODO_ID}`, {
            method: "PUT",
            headers: {
                "Authorization": "Bearer " + JWT,
                "Content-Type": "application/json"
            },
            body: JSON.stringify({ title, isDone })
        })
        .then(res => {
            if (res.status === 401) {
                window.location.href = "/Auth/Login";
                return;
            }

            if (res.ok) {
                window.location.href = "/Todo/Index";
            } else {
                alert("Failed to update todo.");
            }
        });
    }
</script>
