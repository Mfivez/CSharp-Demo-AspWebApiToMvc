@{
    ViewData["Title"] = "Create Todo";
}

<h2>Create Todo</h2>

<div class="mb-3">
    <label class="form-label">Title</label>
    <input id="title" class="form-control" />
</div>

<button class="btn btn-success" onclick="createTodo()">Create</button>

<script>
    const API_BASE = "http://localhost:5062/api/todos";
    const JWT = "@Context.Session.GetString("JWT")";

    if (!JWT) {
        window.location.href = "/Auth/Login";
    }

    function createTodo() {
        const title = document.getElementById("title").value.trim();

        if (title.length < 3) {
            alert("Title must be at least 3 characters long.");
            return;
        }

        fetch(API_BASE, {
            method: "POST",
            headers: {
                "Authorization": "Bearer " + JWT,
                "Content-Type": "application/json"
            },
            body: JSON.stringify({ title })
        })
        .then(res => {
            if (res.status === 401) {
                window.location.href = "/Auth/Login";
                return;
            }

            if (res.ok) {
                window.location.href = "/Todo/Index";
            } else {
                alert("Failed to create todo.");
            }
        });
    }
</script>
